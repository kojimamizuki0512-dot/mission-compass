<% /* レイアウトは server.js の express-ejs-layouts に任せる。ここで layout() は呼びません。 */ %>

<!-- ===== ヒーロー写真：自動ローテーション（商用可：Unsplash / Pexels） ===== -->
<style>
  /* 完全フルブリード（左右の余白ゼロ） */
  .bleed-tight{
    margin-left:calc(50% - 50vw);
    margin-right:calc(50% - 50vw);
    width:100vw;
  }

  .hero-rotator{
    position:relative;
    width:100%;
    height:clamp(420px, 88vh, 1000px);
    background:#000; overflow:hidden;
  }
  @supports (height: 88dvh){
    .hero-rotator{ height:clamp(420px, 88dvh, 1000px); }
  }

  .hero-rotator .slide{
    position:absolute; inset:0;
    opacity:0; transition:opacity .6s ease;   /* 弱めフェード */
  }
  .hero-rotator .slide.on{ opacity:1; }

  /* 画像（<picture>内の<img>） */
  .hero-rotator .slide img{
    width:100%; height:100%; object-fit:cover; display:block;
    transform:scale(1) translate3d(0,0,0);
    will-change: transform;
  }

  /* ===== Ken Burns（弱め：ズーム1.05 + パン0.8%） ===== */
  .slide.on img{ animation:kb-center 4.5s ease-in-out both; }
  .slide.kb-tl.on img{ animation-name: kb-tl; }
  .slide.kb-tr.on img{ animation-name: kb-tr; }
  .slide.kb-bl.on img{ animation-name: kb-bl; }
  .slide.kb-br.on img{ animation-name: kb-br; }

  @keyframes kb-center{
    from{ transform:scale(1.05) translate3d(0,0,0) }
    to  { transform:scale(1.0)  translate3d(0,0,0) }
  }
  @keyframes kb-tl{
    from{ transform:scale(1.05) translate3d(0.8%, 0.8%, 0) }
    to  { transform:scale(1.0)  translate3d(0,0,0) }
  }
  @keyframes kb-tr{
    from{ transform:scale(1.05) translate3d(-0.8%, 0.8%, 0) }
    to  { transform:scale(1.0)  translate3d(0,0,0) }
  }
  @keyframes kb-bl{
    from{ transform:scale(1.05) translate3d(0.8%, -0.8%, 0) }
    to  { transform:scale(1.0)  translate3d(0,0,0) }
  }
  @keyframes kb-br{
    from{ transform:scale(1.05) translate3d(-0.8%, -0.8%, 0) }
    to  { transform:scale(1.0)  translate3d(0,0,0) }
  }

  /* ===== キャプション（枠なし・個別配置／弱めの出現） ===== */
  .hero-rotator .cap{
    position:absolute; color:#fff; font-weight:800;
    font-size:clamp(18px, 3.6vw, 26px); letter-spacing:.04em; line-height:1.2;
    text-shadow:0 2px 10px rgba(0,0,0,.45), 0 6px 22px rgba(0,0,0,.28);
    padding:0; margin:0;
    opacity:0; transform:translateY(6px);
  }
  .slide.on .cap{ animation:capIn .5s cubic-bezier(.25,.7,.25,1) .08s both; }
  @keyframes capIn{
    from{ opacity:0; transform:translateY(8px) }
    to  { opacity:1; transform:none }
  }

  /* 位置バリエーション */
  .cap.tl{ top:7%;  left:5%; }
  .cap.tr{ top:7%;  right:5%; text-align:right; }
  .cap.bl{ bottom:7%; left:5%; }
  .cap.br{ bottom:7%; right:5%; text-align:right; }
  .cap.c{
    top:50%; left:50%; transform:translate(-50%,-50%);
    text-align:center;
  }
  .slide.on .cap.c{ animation-delay:.14s; }

  /* デスクトップ微調整 */
  @media (min-width:920px){
    .hero-rotator .cap{ font-size:clamp(18px, 2.1vw, 24px); }
    .hero-rotator{ border-radius:16px; }
  }

  .dots{
    position:absolute; left:0; right:0; bottom:12px;
    display:flex; justify-content:center; gap:6px; pointer-events:none;
  }
  .dot{width:6px; height:6px; border-radius:999px; background:#cbd5e1; opacity:.9}
  .dot.on{ background:#ffffff; }
</style>

<div class="bleed-tight">
  <div class="hero-rotator" id="heroRotator" aria-label="インスピレーション写真">
    <!-- 1. 紙吹雪のライブ（華やか） → 左上パン（弱） -->
    <figure class="slide kb-tl on">
      <picture>
        <!-- AVIF / WebP を優先（Unsplashは fm= で明示） -->
        <source type="image/avif" srcset="https://images.unsplash.com/photo-1492684223066-81342ee5ff30?fm=avif&fit=crop&w=1600&q=70" />
        <source type="image/webp" srcset="https://images.unsplash.com/photo-1492684223066-81342ee5ff30?fm=webp&fit=crop&w=1600&q=80" />
        <img src="https://images.unsplash.com/photo-1492684223066-81342ee5ff30?auto=format&fit=crop&w=1600&q=80"
             alt="紙吹雪が舞う大規模ライブの熱狂" width="1600" height="900"
             loading="eager" fetchpriority="high" />
      </picture>
      <figcaption class="cap tl">スポットライトは、あなたへ。</figcaption>
    </figure>

    <!-- 2. 強い照明のシンガー → 右下パン（弱） -->
    <figure class="slide kb-br">
      <picture>
        <source type="image/avif" srcset="https://images.unsplash.com/photo-1470225620780-dba8ba36b745?fm=avif&fit=crop&w=1600&q=70" />
        <source type="image/webp" srcset="https://images.unsplash.com/photo-1470225620780-dba8ba36b745?fm=webp&fit=crop&w=1600&q=80" />
        <img src="https://images.unsplash.com/photo-1470225620780-dba8ba36b745?auto=format&fit=crop&w=1600&q=80"
             alt="強い照明の中で歌うシンガー" width="1600" height="900"
             loading="lazy" decoding="async" />
      </picture>
      <figcaption class="cap br">一歩、光の中へ。</figcaption>
    </figure>

    <!-- 3. 機内窓の夕焼け → 中央ズーム（弱） -->
    <figure class="slide">
      <picture>
        <source type="image/avif" srcset="https://images.unsplash.com/photo-1529070538774-1843cb3265df?fm=avif&fit=crop&w=1600&q=70" />
        <source type="image/webp" srcset="https://images.unsplash.com/photo-1529070538774-1843cb3265df?fm=webp&fit=crop&w=1600&q=80" />
        <img src="https://images.unsplash.com/photo-1529070538774-1843cb3265df?auto=format&fit=crop&w=1600&q=80"
             alt="飛行機の窓から見る夕焼け" width="1600" height="900"
             loading="lazy" decoding="async" />
      </picture>
      <figcaption class="cap c">次の目的地は、世界。</figcaption>
    </figure>

    <!-- 4. 花火の夜景 → 右上パン（弱） -->
    <figure class="slide kb-tr">
      <picture>
        <source type="image/avif" srcset="https://images.unsplash.com/photo-1469474968028-56623f02e42e?fm=avif&fit=crop&w=1600&q=70" />
        <source type="image/webp" srcset="https://images.unsplash.com/photo-1469474968028-56623f02e42e?fm=webp&fit=crop&w=1600&q=80" />
        <img src="https://images.unsplash.com/photo-1469474968028-56623f02e42e?auto=format&fit=crop&w=1600&q=80"
             alt="花火が上がる都市の夜景" width="1600" height="900"
             loading="lazy" decoding="async" />
      </picture>
      <figcaption class="cap tr">努力は、必ず祝われる。</figcaption>
    </figure>

    <!-- 5. ラグジュアリーな家族の時間 → 左下パン（弱） -->
    <figure class="slide kb-bl">
      <picture>
        <!-- Pexels は WebP/AVIFが効かない場合もあるのでフォールバック付き -->
        <source type="image/webp" srcset="https://images.pexels.com/photos/1571460/pexels-photo-1571460.jpeg?auto=compress&cs=tinysrgb&w=1600&format=webp" />
        <img src="https://images.pexels.com/photos/1571460/pexels-photo-1571460.jpeg?auto=compress&cs=tinysrgb&w=1600"
             alt="明るいリビングでの家族の団欒" width="1600" height="1067"
             loading="lazy" decoding="async" />
      </picture>
      <figcaption class="cap bl">大切な人と、豊かな時間を。</figcaption>
    </figure>

    <div class="dots" id="heroDots" aria-hidden="true">
      <div class="dot on"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>
    </div>
  </div>
</div>

<section class="hero">
  <h1>なぜ学ぶのか、を決めよう。</h1>
  <p class="lead">
    AIとの対話で、最終目標と道筋を明確化。今日から動ける「最初の一歩」へ。
  </p>
  <form method="post" action="/start">
    <button class="btn cta" type="submit"
      style="padding:20px 26px; font-size:18px; border-radius:18px;
             box-shadow:0 18px 40px rgba(31,111,235,.26), 0 10px 22px rgba(16,185,129,.18);">
      はじめる（¥100）
    </button>
  </form>
  <div class="chips" style="margin-top:12px">
    <span class="chip">安全なStripe決済</span>
    <span class="chip">所要10〜15分</span>
    <span class="chip">保存なし（MVP）</span>
  </div>
</section>

<section class="features">
  <div class="feature">
    <h3>AI対話で自己発見</h3>
    <p>雑念を削ぎ落とし、価値観と願望を言語化。</p>
  </div>
  <div class="feature">
    <h3>あなただけの羅針盤</h3>
    <p>ぶれない“軸”を一文で定義。選択が速くなる。</p>
  </div>
  <div class="feature">
    <h3>最初の一歩</h3>
    <p>今週やることまで分解。今日から動ける。</p>
  </div>
</section>

<script>
  // 自動ローテーション（4.5秒／互換重視）
  document.addEventListener('DOMContentLoaded', function(){
    var rotator = document.getElementById('heroRotator');
    if (!rotator) return;
    var slides = rotator.querySelectorAll('.slide');
    var dotsWrap = document.getElementById('heroDots');
    var dots = dotsWrap ? dotsWrap.children : [];
    var i = 0, intervalMs = 4500;

    function show(n){
      if (!slides.length) return;
      if (slides[i]) slides[i].classList.remove('on');
      if (dots[i]) dots[i].classList.remove('on');
      i = (n + slides.length) % slides.length;
      if (slides[i]) slides[i].classList.add('on');
      if (dots[i]) dots[i].classList.add('on');
    }
    setInterval(function(){ show(i + 1); }, intervalMs);
  });
</script>
