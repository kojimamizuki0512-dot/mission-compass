<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0B2A6B" />
  <title><%= title || "Mission Compass" %></title>
  <link rel="stylesheet" href="/styles.css" />
  <meta name="description" content="AIとの対話で最終目標と道筋を明確化。今日から動ける『最初の一歩』まで伴走します。" />

  <!-- Favicon (navy) -->
  <link rel="icon" type="image/svg+xml" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 96 96"><circle cx="48" cy="48" r="41" fill="none" stroke="%230B2A6B" stroke-width="6"/><path d="M48 12v72M12 48h72" stroke="%230B2A6B" stroke-width="6"/><path d="M48 18l-10 28-28 10 28 10 10 28 10-28 28-10-28-10-10-28z" fill="%230B2A6B"/></svg>' />

  <style>
    /* ========= Color System ========= */
    :root{
      /* base */
      --cream:#F6F1E7;              /* ベース70% */
      --cream-2:#F3EDE2;            /* セクション差異 */
      --white:#FFFFFF;              /* サブ20%の白系 */
      --light-gray:#F2F4F6;         /* サブ20%の薄いグレー */

      /* text & lines */
      --ink:#1F2329;                /* 本文色 */
      --charcoal:#3B4044;           /* 境界線（落ち着いたチャコール） */

      /* accents 10% */
      --dark-blue:#0B2A6B;          /* 主要アクション/ヘッダーテキスト */
      --olive:#6B8E23;              /* 学習達成度バー */
      --burnt-orange:#C45525;       /* 重要度高 */
      --deep-purple:#5B3E96;        /* 設定/プロフィール */

      --shadow:0 10px 28px rgba(2,8,20,.06), 0 2px 6px rgba(2,8,20,.04);
      --radius:16px;
    }

    /* ========= Base ========= */
    html,body{ background:var(--cream); color:var(--ink); }
    .container{ max-width:1100px; margin:0 auto; padding:12px 16px; }

    /* ========= Header ========= */
    .site-header{
      position:sticky; top:0; z-index:50;
      background:rgba(246,241,231,.92); /* クリームに合わせた半透明 */
      backdrop-filter:saturate(140%) blur(10px);
      -webkit-backdrop-filter:saturate(140%) blur(10px);
      transition:box-shadow .2s ease, background .2s ease;
      border-bottom:1px solid rgba(59,64,68,.12);
    }
    .site-header .container{
      padding-left:max(16px, env(safe-area-inset-left));
      padding-right:max(16px, env(safe-area-inset-right));
      padding-top:max(10px,12px);
      padding-bottom:max(10px,12px);
    }
    .header-inner{ display:flex; align-items:baseline; justify-content:space-between; gap:12px; }
    body[data-scrolled="1"] .site-header{ box-shadow:var(--shadow); }

    /* brand */
    .brand-wrap{ display:flex; align-items:baseline; gap:10px; text-decoration:none; color:var(--dark-blue); min-height:36px; }
    .brand-logo{ width:34px; height:34px; color:var(--dark-blue); display:inline-flex; align-items:center; justify-content:center; margin-top:2px; transition:transform .25s ease, filter .25s ease; }
    .brand-logo svg{ width:34px; height:34px; display:block; }
    .brand-logo::before{
      content:""; position:absolute; inset:-8px; border-radius:50%;
      background:conic-gradient(from 0deg, rgba(11,42,107,.00), rgba(11,42,107,.22), rgba(11,42,107,.00) 60%);
      filter:blur(8px); opacity:.30; z-index:-1; animation:haloSpin 8s linear infinite;
    }
    @keyframes haloSpin{ to{ transform:rotate(360deg); } }
    .brand-wrap:hover .brand-logo{ transform:rotate(6deg); filter:drop-shadow(0 6px 10px rgba(11,42,107,.22)); }

    .brand-name{ font-weight:900; letter-spacing:.2px; line-height:1; position:relative; padding-bottom:4px; }
    .brand-name::after{
      content:""; position:absolute; left:0; bottom:0; height:2px; width:100%;
      background:linear-gradient(90deg,var(--dark-blue), #1f6feb 55%, #0EA5A5);
      border-radius:2px; background-size:200% 100%; animation:shine 6s linear infinite;
    }
    @keyframes shine{ 0%{background-position:0% 50%} 100%{background-position:200% 50%} }

    /* nav buttons */
    .site-header nav{ display:flex; align-items:center; gap:12px; flex-wrap:wrap; }
    .btn{
      appearance:none; -webkit-appearance:none;
      padding:12px 16px; border-radius:14px; border:1px solid transparent;
      min-height:44px; font-weight:800; letter-spacing:.2px; line-height:1; cursor:pointer;
      background:var(--dark-blue); color:#fff;
      transition:transform .12s ease, box-shadow .12s ease, background .12s ease, border-color .12s ease;
    }
    .btn:hover{ transform:translateY(-1px) }
    .btn:active{ transform:translateY(0) scale(.99) }
    .btn:focus-visible{ outline:3px solid rgba(11,42,107,.28); outline-offset:2px }

    .btn.ghost{
      background:var(--white); color:var(--dark-blue);
      border:1px solid rgba(59,64,68,.22);
    }

    /* mobile: two columns equal width */
    @media (max-width:520px){
      .site-header nav{ display:grid; grid-template-columns:1fr 1fr; gap:10px; width:min(340px,82vw); }
      .site-header .btn{ width:100%; justify-content:center; border-radius:16px; padding:12px 12px; }
    }

    /* ========= Utility: Progress / Accent ========= */
    .progress{
      height:10px; border-radius:8px; background:rgba(59,64,68,.15);
      overflow:hidden; border:1px solid rgba(59,64,68,.18);
    }
    .progress > i{ display:block; height:100%; width:0; }
    .progress--learning > i{ background:var(--olive); }
    .progress--important > i{ background:var(--burnt-orange); }

    .section--settings h1, .section--profile h1{ color:var(--deep-purple); }

    /* CTA pulse（下層で使用） */
    .btn.cta{ animation:ctaPulse 2.6s ease-in-out infinite alternate; }
    @keyframes ctaPulse{
      from{ box-shadow:0 12px 28px rgba(11,42,107,.18); transform:translateY(0) scale(1) }
      to  { box-shadow:0 18px 40px rgba(11,42,107,.26); transform:translateY(-1px) scale(1.012) }
    }

    @media (prefers-reduced-motion:reduce){
      .brand-logo::before, .brand-wrap:hover .brand-logo, .brand-name::after, .btn.cta{ animation:none !important; }
      .btn, .brand-logo{ transition:none !important; }
      .site-header{ backdrop-filter:none; -webkit-backdrop-filter:none; }
    }

    @media (min-width:920px){
      .brand-logo{ width:36px; height:36px }
      .brand-logo svg{ width:36px; height:36px }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a href="/" class="brand-wrap" aria-label="Mission Compass">
        <span class="brand-logo" aria-hidden="true">
          <svg viewBox="0 0 96 96" xmlns="http://www.w3.org/2000/svg" fill="none">
            <circle cx="48" cy="48" r="41" stroke="currentColor" stroke-width="6"/>
            <path d="M48 12v72M12 48h72" stroke="currentColor" stroke-width="6"/>
            <path d="M48 18l-10 28-28 10 28 10 10 28 10-28 28-10-28-10-10-28z" fill="currentColor"/>
          </svg>
        </span>
        <span class="brand-name">Mission Compass</span>
      </a>
      <nav>
        <% if (currentUser) { %>
          <span class="nav-email"><%= currentUser.email %></span>
          <form method="post" action="/logout" style="display:inline;">
            <button class="btn ghost" type="submit">ログアウト</button>
          </form>
        <% } else { %>
          <a class="btn ghost" href="/login">ログイン</a>
          <a class="btn" href="/signup">新規登録</a>
        <% } %>
      </nav>
    </div>
  </header>

  <main class="container">
    <%- body %>
  </main>

  <footer class="site-footer" style="border-top:1px solid rgba(59,64,68,.12); background:var(--cream-2);">
    <div class="container">© <script>document.write(new Date().getFullYear())</script> Mission Compass</div>
  </footer>

  <script>
    (function(){
      function onScroll(){ document.body.setAttribute('data-scrolled', (window.pageYOffset>6 ? '1':'0')); }
      window.addEventListener('scroll', onScroll, {passive:true});
      onScroll();
    })();
  </script>
</body>
</html>
